"use strict";var TwitchViewer=function(e,s){var t=[],a={},n=0;return localStorage.hasOwnProperty("userList")?(console.log("Found Local List"),t=localStorage.getItem("userList").split(", "),console.log(t)):(console.log("Initializing List"),localStorage.setItem("userList",e),t=e.split(", ")),n=t.length,{createUserObj:function(e){var s=$('<div class="collapse-user collapse">'),t=$('<div class="user-container">'),n=$('<a class="user" target="_blank" rel="noopener noreferrer" href="https://www.twitch.tv/'+e+'">');n.append($('<div class="user-logo">').append($("<img>"))),n.append($('<div class="user-text">').append($('<h4 class="display-name"></h4><p class="user-status"></p><p class="user-game"></p>'))),t.append(n),t.append($('<div class="user-remove">').append($('<a class="x" href="#"><i class="fa fa-times-circle" aria-hidden="true"></i></a>'))),s.append(t),a[e]={collapser:s,logo:s.find("img"),displayName:s.find(".display-name"),status:s.find(".user-status"),game:s.find(".user-game"),isOnline:null}},deleteUser:function(e){var s=$(e).closest(".collapse-user"),n=$(e).closest(".user-container").find("h4").html().toLowerCase(),l=t.indexOf(n);l!==-1&&(t.splice(l,1),delete a[n],localStorage.setItem("userList",t.join(", ")),s.collapse("hide"),setTimeout(function(){$(s).remove()},5e3))},resetLocalList:function(){localStorage.setItem("userList",e),t=e.split(", "),location.reload()},sortUsers:function(e){var s=e?"#users-online":"#users-offline",t=$(s+" .collapse-user"),a=t.sort(function(e,s){return $(e).find("h4").text().toLowerCase()>$(s).find("h4").text().toLowerCase()});$(s).append(a)},parseUserData:function(e,s,t){var l="",o="",r="",i={},c=null,u="",p="",h=0;s?(r=e.stream.channel.display_name,l=e.stream.channel.logo,o=e.stream.channel.name,i=a[o],c=i.collapser,p="",h=0,i.isOnline===!1&&(console.log("Switching user "+r+" to Online list."),c.collapse("hide"),setTimeout(function(){$(c).remove()},5e3)),i.logo.attr({src:l,alt:r+" avatar"}),u=e.stream.channel.status||"",p=e.stream.game?"Streaming: "+e.stream.game:"",h=e.stream.viewers?e.stream.viewers+" viewers":0,i.displayName.text(r),i.status.text(u),i.game.text(p+" - "+h),null!==i.isOnline&&i.isOnline!==!1||(console.log("Added user "+r+" to Online list."),i.isOnline=!0,$("#users-online").append(c),this.sortUsers(!0),c.collapse("show"))):s===!1?(r=e.display_name,l=e.logo,o=e.name,i=a[o],c=i.collapser,i.isOnline===!0&&(console.log("Switching user "+o+" to Offline list."),c.collapse("hide"),setTimeout(function(){$(c).remove()},5e3)),i.logo.attr({src:l,alt:r+" avatar"}),u=e.status||"",i.displayName.text(r),i.status.text(u),i.game.text(""),null!==i.isOnline&&i.isOnline!==!0||(console.log("Added user "+r+" to Offline list."),i.isOnline=!1,$("#users-offline").append(c),this.sortUsers(!1),c.collapse("show"))):(i=a[e],c=i.collapser,i.isOnline===!0&&(console.log("Switching user "+e+" to Offline list."),c.collapse("hide"),setTimeout(function(){$(c).remove()},5e3)),i.logo.attr({src:"images/default_avatar.png",alt:"default avatar"}),u=e.status||"",i.displayName.text(e),503===t?i.status.html('<p class="null-status">Twitch server is currently unavailable. Please refresh or wait 20 seconds.</p>'):i.status.html('<p class="null-status">This user no longer exists.</p>'),i.game.text(""),null!==i.isOnline&&i.isOnline!==!0||(console.log("Added user "+e+" to Offline list."),i.isOnline=!1,$("#users-offline").append(c),this.sortUsers(!1),c.collapse("show"))),1===n&&setTimeout(function(){$(".loader").fadeOut(),$("#collapse-users").collapse("show")},500),n--},getOfflineUser:function(e){var s=this;$.ajax({dataType:"jsonp",url:e,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(e){s.parseUserData(e,!1,null)},error:function(e){console.log(e)}})},searchUser:function(e){$.ajax({dataType:"jsonp",url:"https://api.twitch.tv/kraken/search/channels?limit=10&q="+e,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(e){console.log(e),$("#search-results").html(""),$.each(e.channels,function(e,s){$("#search-results").append("<p>"+s.display_name+"</p>")}),$("#collapse-search").collapse("show")},error:function(e){console.log(e)}})},updateUserList:function(){console.log("UPDATING...");var e=this;$.each(t,function(s,t){$.ajax({dataType:"jsonp",url:"https://api.twitch.tv/kraken/streams/"+t,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(s){s.hasOwnProperty("error")?(console.log(s),503===s.status?e.parseUserData(t,null,503):e.parseUserData(t,null,null)):null===s.stream?e.getOfflineUser(s._links.channel):e.parseUserData(s,!0,null)},error:function(e){console.log(e)}})})},init:function(){var e=this;$.each(t,function(s,t){e.createUserObj(t)});setInterval(function(){e.updateUserList()},s);e.updateUserList()}}};$(document).ready(function(){var e="esl_sc2, ogamingsc2, freecodecamp, patrickklepek, giantbomb, doublefine, greenspeak, comster404",s=2e4,t=new TwitchViewer(e,s);t.init(),$("#collapse-online").on("hide.bs.collapse show.bs.collapse",function(e){e.target===this&&$("#caret-online").toggleClass("open")}),$("#collapse-offline").on("hide.bs.collapse show.bs.collapse",function(e){e.target===this&&$("#caret-offline").toggleClass("open")}),$(".wrapper").on("click","a.user",function(e){this.blur()}),$(".wrapper").on("click",".user-remove>a",function(e){e.preventDefault(),t.deleteUser(this)}),$("#txt-search").keypress(function(e){var s=$("#txt-search").val();if(""!==s&&13==e.keyCode)return t.searchUser(s),!1}),$(".btn-search").on("click",function(e){this.blur();var s=$("#txt-search").val();""!==s&&t.searchUser(s)}),$("#search-close").on("click",function(e){$("#collapse-search").collapse("hide")}),$(document).keydown(function(e){if(27==e.keyCode)return $("#collapse-search").collapse("hide"),$("#txt-search").val(""),!1}),$(document).keydown(function(e){65==e.keyCode}),$("#btn-reset").on("click",function(e){t.resetLocalList()})});