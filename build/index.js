"use strict";var TwitchViewer=function(e,s){var a=[],t={},r=0;return localStorage.hasOwnProperty("userList")?a=localStorage.getItem("userList").split(", "):(localStorage.setItem("userList",e),a=e.split(", ")),r=a.length,{createUserObj:function(e){var s=$('<li class="collapse-user collapse">'),a=$('<div class="user-container">'),r=$('<a class="user" target="_blank" rel="noopener noreferrer" href="https://www.twitch.tv/'+e+'">');r.append($('<div class="user-logo">').append($("<img>"))),r.append($('<div class="user-text">').append($('<h4 class="display-name"></h4><p class="user-status"></p><p class="user-game"></p>'))),a.append(r),a.append($('<div class="user-remove">').append($('<a class="x" href="#"><i class="fa fa-times-circle" aria-hidden="true"></i></a>'))),s.append(a),t[e]={collapser:s,logo:s.find("img"),displayName:s.find(".display-name"),status:s.find(".user-status"),game:s.find(".user-game"),isOnline:null}},addUser:function(e){$("#collapse-search").collapse("hide"),$("#txt-search").val("");var s=$(e).closest(".user-container").find("h4").html().toLowerCase();a.indexOf(s)===-1&&(a.push(s),localStorage.setItem("userList",a.join(", ")),this.createUserObj(s),this.updateUserList())},deleteUser:function(e){var s=$(e).closest(".collapse-user"),r=$(e).closest(".user-container").find("h4").html().toLowerCase(),n=a.indexOf(r);n!==-1&&(a.splice(n,1),delete t[r],localStorage.setItem("userList",a.join(", ")),s.collapse("hide"),setTimeout(function(){$(s).remove()},5e3))},resetLocalList:function(){localStorage.setItem("userList",e),a=e.split(", "),location.reload()},sortUsers:function(e){var s=e?"#users-online":"#users-offline",a=$(s+" .collapse-user"),t=a.sort(function(e,s){return $(e).find("h4").text().toLowerCase()>$(s).find("h4").text().toLowerCase()});$(s).append(t)},parseUserData:function(e,s,a){var n=this,l="",i="",o="",c={},p=null,u="",h="",d=0;s?(o=e.stream.channel.display_name,l=e.stream.channel.logo||"images/default_avatar.png",i=e.stream.channel.name,c=t[i],p=c.collapser,h="",d=0,c.isOnline===!1&&(p.collapse("hide"),setTimeout(function(){$(p).remove(),c.isOnline=!0,$("#users-online").append(p),n.sortUsers(!0),p.collapse("show")},1e3)),c.logo.attr({src:l,alt:o+" avatar"}),u=e.stream.channel.status||"",h=e.stream.game?"Streaming: "+e.stream.game:"",d=e.stream.viewers?e.stream.viewers+" viewers":0,c.displayName.text(o),c.status.text(u),c.game.text(h+" - "+d),null===c.isOnline&&(c.isOnline=!0,$("#users-online").append(p),n.sortUsers(!0),p.collapse("show"))):s===!1?(o=e.display_name,l=e.logo||"images/default_avatar.png",i=e.name,c=t[i],p=c.collapser,c.isOnline===!0&&(p.collapse("hide"),setTimeout(function(){$(p).remove(),c.isOnline=!1,$("#users-offline").append(p),n.sortUsers(!1),p.collapse("show")},1e3)),c.logo.attr({src:l,alt:o+" avatar"}),u=e.status||"",c.displayName.text(o),c.status.text(u),c.game.text(""),null===c.isOnline&&(c.isOnline=!1,$("#users-offline").append(p),n.sortUsers(!1),p.collapse("show"))):(c=t[e],p=c.collapser,c.isOnline===!0&&(p.collapse("hide"),setTimeout(function(){$(p).remove(),c.isOnline=!1,$("#users-offline").append(p),n.sortUsers(!1),p.collapse("show")},1e3)),c.logo.attr({src:"images/default_avatar.png",alt:e+" avatar"}),u=e.status||"",c.displayName.text(e),503===a?c.status.html('<p class="null-status">Twitch server is currently unavailable. Please refresh or wait 20 seconds.</p>'):c.status.html('<p class="null-status">This user no longer exists.</p>'),c.game.text(""),null===c.isOnline&&(c.isOnline=!1,$("#users-offline").append(p),n.sortUsers(!1),p.collapse("show"))),1===r&&setTimeout(function(){$(".loader").fadeOut(),$("#collapse-users").collapse("show")},500),r--},getOfflineUser:function(e){var s=this;$.ajax({dataType:"jsonp",url:e,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(e){s.parseUserData(e,!1,null)},error:function(e){console.log(e)}})},parseSearch:function(e){var s=$('<li class="user-container">'),t=$('<a class="user" target="_blank" rel="noopener noreferrer" href="https://www.twitch.tv/'+e.name+'">'),r=e.display_name,n=e.logo||"images/default_avatar.png",l=e.status||"",i=$("#collapse-users").find(".user-logo").width()+"px";t.append($('<div class="user-logo" style="height:'+i+"; width:"+i+'">').append($('<img src="'+n+'" alt="'+r+' avatar">'))),t.append($('<div class="user-text">').append($('<h4 class="display-name">'+r+'</h4><p class="user-status">'+l+'</p><p class="user-game"></p>'))),s.append(t),a.indexOf(e.name)===-1?s.append($('<div class="user-add">').append($('<a class="x" href="#"><i class="fa fa-plus-circle" aria-hidden="true"></i></a>'))):s.append($<'<div class="user-add">'),$("#search-results").append(s),$.ajax({dataType:"jsonp",url:"https://api.twitch.tv/kraken/streams/"+e.name,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(e){if(e.hasOwnProperty("error"));else if(null!==e.stream){var s=e.stream.game?"Streaming: "+e.stream.game:"",a=e.stream.viewers?e.stream.viewers+" viewers":0;t.find($(".user-game")).text(s+" - "+a)}},error:function(e){console.log(e)}})},searchUser:function(e){var s=this;$.ajax({dataType:"jsonp",url:"https://api.twitch.tv/kraken/search/channels?limit=10&q="+e,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(e){$("#search-results").html(""),0!==e.channels.length?$.each(e.channels,function(e,a){s.parseSearch(a)}):$("#search-results").append($('<p class="no-results">No results found.</p>')),setTimeout(function(){$("#collapse-search").collapse("show")},100)},error:function(e){console.log(e)}})},updateUserList:function(){var e=this;$.each(a,function(s,a){$.ajax({dataType:"jsonp",url:"https://api.twitch.tv/kraken/streams/"+a,headers:{"Client-ID":"ijknjytczppohdhsy0zmsukeu4hv2gu"},success:function(s){s.hasOwnProperty("error")?503===s.status?e.parseUserData(a,null,503):e.parseUserData(a,null,null):null===s.stream?e.getOfflineUser(s._links.channel):e.parseUserData(s,!0,null)},error:function(e){console.log(e)}})})},init:function(){var e=this;$.each(a,function(s,a){e.createUserObj(a)});setInterval(function(){e.updateUserList()},s);e.updateUserList()}}};$(document).ready(function(){var e="esl_sc2, ogamingsc2, freecodecamp, patrickklepek, giantbomb, doublefine, greenspeak, comster404",s=2e4,a=new TwitchViewer(e,s);a.init(),$("#collapse-online").on("hide.bs.collapse show.bs.collapse",function(e){e.target===this&&$("#caret-online").toggleClass("open")}),$("#collapse-offline").on("hide.bs.collapse show.bs.collapse",function(e){e.target===this&&$("#caret-offline").toggleClass("open")}),$(".wrapper").on("click","a.user",function(e){this.blur()}),$(".wrapper").on("click",".user-remove>a",function(e){e.preventDefault(),a.deleteUser(this)}),$("#txt-search").keypress(function(e){var s=$("#txt-search").val();if(""!==s&&13==e.keyCode)return $("#collapse-search").collapse("hide"),a.searchUser(s),!1}),$(".btn-search").on("click",function(e){this.blur();var s=$("#txt-search").val();""!==s&&($("#collapse-search").collapse("hide"),a.searchUser(s))}),$(".wrapper").on("click",".user-add>a",function(e){e.preventDefault(),a.addUser(this)}),$("#search-close").on("click",function(e){$("#collapse-search").collapse("hide"),$("#txt-search").val("")}),$(document).keydown(function(e){if(27==e.keyCode)return $("#collapse-search").collapse("hide"),$("#txt-search").val(""),!1}),$("#btn-reset").on("click",function(e){a.resetLocalList()})});